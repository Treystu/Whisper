<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Whisper Chat</title>
  <style>
    body { font-family: sans-serif; margin:0; display:flex; flex-direction:column; height:100vh; }
    #status { padding:8px; background:#eee; }
    #messages { flex:1; padding:8px; overflow-y:auto; }
    #inputRow { display:flex; padding:8px; gap:4px; }
    #text { flex:1; }
  </style>
</head>
<body>
  <div id="status">Connecting…</div>
  <div id="messages"></div>
  <div id="inputRow">
    <input id="text" autocomplete="off" placeholder="Type a message" />
    <button id="send">Send</button>
      <a id="downloadLogs" href="/logs" download>Download Logs</a>
  </div>
  <script>
    const statusEl = document.getElementById('status');
    const messagesEl = document.getElementById('messages');

    function log(msg) {
      const div = document.createElement('div');
      div.textContent = msg;
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function connect() {
      const es = new EventSource('/events');
      es.onopen = () => statusEl.textContent = 'Connected';
      es.onmessage = (e) => log(e.data);
      es.onerror = () => {
        statusEl.textContent = 'Disconnected. Reconnecting…';
        es.close();
        setTimeout(connect, 1000);
      };
    }

    connect();

    document.getElementById('send').onclick = async () => {
      const text = document.getElementById('text').value;
      if (!text) return;
      log('Me: ' + text);
      document.getElementById('text').value = '';
      await fetch('/message', { method: 'POST', body: text });
    };

    document.getElementById('text').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('send').click();
      }
    });
  </script>
</body>
</html>
